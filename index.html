<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Словопад</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      overflow: hidden;
      background: url('https://i.postimg.cc/ryB5VyKX/Whisk-a93828ba6f82033b74d43582ccef6c05dr.png') center center / cover no-repeat fixed;
      height: 100vh;
      position: relative;
      color: white;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.9);
    }

    #ui {
      position: absolute;
      top: 30px;
      left: 30px;
      z-index: 10;
      background: rgba(0,0,0,0.65);
      padding: 14px 18px;
      border-radius: 10px;
      display: flex;
      gap: 20px;
      align-items: center;
      font-size: 20px;
    }

    #score, #accuracy {
      font-size: 20px;
    }

    #lang-switch {
      margin-left: auto;
      background: #4a90e2;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      font-size: 18px;
    }

    .snowflake {
      position: absolute;
      font-size: 108px; /* В 3 раза больше исходного (36 → 108) */
      white-space: nowrap;
      user-select:-none;
      opacity: 0.92;
      text-align: center;
      width: 150px; /* 3× от 50px */
      transform: translateX(-50%);
      line-height: 1;
    }

    .snowflake-text {
      display: block;
      font-weight: bold;
      font-size: 48px; /* 3× от 16px */
      margin-top: 8px;
      color: white;
      text-shadow: 1px 1px 4px rgba(0,0,0,0.95);
    }

    #input-area {
      position: absolute;
      bottom: 50px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
    }

    #user-input {
      font-size: 28px;
      padding: 12px 20px;
      width: 400px;
      text-align: center;
      border: 3px solid #4a90e2;
      border-radius: 8px;
      outline: none;
      background: rgba(255,255,255,0.95);
    }

    #game-over {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.88);
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
      z-index: 100;
      font-size: 36px;
    }

    #restart-btn {
      margin-top: 24px;
      padding: 12px 28px;
      font-size: 22px;
      background: #4a90e2;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="ui">
    <div id="score">Очки: 0</div>
    <div id="accuracy">Точность: 100%</div>
    <button id="lang-switch">EN</button>
  </div>

  <div id="input-area">
    <input id="user-input" type="text" autocomplete="off" placeholder="Введите слово..." autofocus />
  </div>

  <div id="game-over">
    <div>Игра окончена!</div>
    <div id="final-score">Очки: 0</div>
    <button id="restart-btn">Начать заново</button>
  </div>

  <script>
    const words = {
      ru: ['учитель', 'линейка', 'ластик', 'книга', 'тетрадь', 'шкаф', 'полка', 'стул', 'парта', 'доска', 'стол', 'сумка'],
      en: ['teacher', 'ruler', 'eraser', 'book', 'notebook', 'cupboard', 'bookcase', 'chair', 'desk', 'board', 'table', 'bag']
    };

    let score = 0;
    let totalTyped = 0;
    let correctTyped = 0;
    let activeFlakes = [];
    let gameRunning = true;
    let currentLang = 'en';

    const scoreEl = document.getElementById('score');
    const accuracyEl = document.getElementById('accuracy');
    const userInput = document.getElementById('user-input');
    const langSwitch = document.getElementById('lang-switch');
    const gameOverEl = document.getElementById('game-over');
    const finalScoreEl = document.getElementById('final-score');
    const restartBtn = document.getElementById('restart-btn');

    const FALL_SPEED = 0.9; // медленно и без ускорения

    function getRandomWord() {
      const list = words[currentLang];
      return list[Math.floor(Math.random() * list.length)];
    }

    function createSnowflake(withWord = true) {
      if (!gameRunning) return;

      const flake = document.createElement('div');
      flake.className = 'snowflake';
      flake.innerHTML = withWord
        ? `❄<span class="snowflake-text">${getRandomWord()}</span>`
        : '❄';

      const startX = Math.random() * (window.innerWidth - 160) + 80;
      flake.style.left = startX + 'px';
      flake.style.top = '-160px';

      document.body.appendChild(flake);

      const obj = {
        el: flake,
        word: withWord ? flake.querySelector('.snowflake-text').textContent : null,
        speed: FALL_SPEED,
        startX: startX,
        sway: Math.random() * 30 + 10,
        swaySpeed: Math.random() * 0.03 + 0.01
      };

      if (withWord) activeFlakes.push(obj);
    }

    function updateFlakes() {
      activeFlakes = activeFlakes.filter(f => {
        const top = parseFloat(f.el.style.top);
        const newTop = top + f.speed;
        const swayOffset = Math.sin(top * f.swaySpeed) * f.sway;
        f.el.style.top = newTop + 'px';
        f.el.style.left = (f.startX + swayOffset) + 'px';

        if (newTop > window.innerHeight) {
          f.el.remove();
          return false;
        }

        if (f.word && newTop > window.innerHeight - 220) {
          endGame();
          return false;
        }

        return true;
      });
    }

    function checkInput() {
      const input = userInput.value.trim().toLowerCase();
      if (!input) return;

      const index = activeFlakes.findIndex(f => f.word && f.word.toLowerCase() === input);
      if (index !== -1) {
        const f = activeFlakes[index];
        f.el.style.opacity = '0';
        f.el.style.transform = 'translateX(-50%) scale(1.3)';
        setTimeout(() => {
          if (f.el.parentNode) f.el.remove();
        }, 300);

        activeFlakes.splice(index, 1);
        score += 10;
        correctTyped++;
        totalTyped++;
        userInput.value = '';
        updateUI();
      } else {
        totalTyped++;
        updateUI();
      }
    }

    function updateUI() {
      scoreEl.textContent = `Очки: ${score}`;
      const accuracy = totalTyped > 0 ? Math.round((correctTyped / totalTyped) * 100) : 100;
      accuracyEl.textContent = `Точность: ${accuracy}%`;
    }

    function endGame() {
      gameRunning = false;
      finalScoreEl.textContent = `Очки: ${score}`;
      gameOverEl.style.display = 'flex';
      clearInterval(window.spawnInterval);
      clearInterval(window.animateInterval);
    }

    function startGame() {
      score = 0; totalTyped = 0; correctTyped = 0;
      activeFlakes.forEach(f => f.el.remove());
      activeFlakes = [];
      userInput.value = '';
      gameRunning = true;
      gameOverEl.style.display = 'none';
      updateUI();

      clearInterval(window.spawnInterval);
      clearInterval(window.animateInterval);

      window.spawnInterval = setInterval(() => {
        if (gameRunning) {
          createSnowflake(Math.random() < 0.6); // 60% — со словами
        }
      }, 1800);

      window.animateInterval = setInterval(updateFlakes, 40);
    }

    userInput.addEventListener('input', checkInput);

    langSwitch.addEventListener('click', () => {
      currentLang = currentLang === 'en' ? 'ru' : 'en';
      langSwitch.textContent = currentLang.toUpperCase();
    });

    restartBtn.addEventListener('click', startGame);

    startGame();
  </script>
</body>
</html>